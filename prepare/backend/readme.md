# 백엔드 노드 서버 구축하기

# 1. 노드로 서버 구동하기

- node는 v8 엔진을 사용한 자바스크립트 런타임이다. (node.js 자체가 서버라는 뜻이 아니다.)
- 런타임이란 자바스크립트 코드를 실행할 수 있도록 도와주는 것을 말한다.
- node 환경에서 app.js를 실행하는 순간 노드 런타임이 코드를 실행해서 app.js에 입력한 http가 서버 역할을 한다.
- backend 서버에서는 우리가 front에서 만들었던 axios.post('/')를 통해 보내지는 주소들이 backend 서버이다.
- 쉽게 말해 프론트서버에서 넘어오는 요청들(req, request)를 백엔드 서버에서 받아주고 요청에 따라 처리된 결과를 (res,response) 다시 프론트에 보내주는 것이 일반적인 흐름이다.
- 한 번 요청에 따른 한 번 응답이 기본적인 프로세스이며, 요청이 왔을 때 응답을 하지 않을 경우 브라우저에서 일정시간(30초) 후에 자동으로 실패 응답을 보내게 된다.

```js
axios.post('/post', postData, {
  withCredentials: true,
});

- 위 코드에서 `/post`로 불려지는 부분(주소)이 백엔드 서버이다.
```

- 프론트 서버와 백엔드 서버를 나누는 가장 큰 이유는 대규모 앱이 되었을 때를 대비하기 위해서이다.
- 서버 한 곳에 프론트와 백을 모두 담을 경우 프론트가 하는 SSR(서버사이드렌더링), 백이 하는 API 를 모두 다뤄야 한다.
- 따라서 사용자가 증가하거나, 요청 사항이 증가하면 더이상 한 서버에서 이 둘을 모두 감당하기 힘든 트레픽이 발생할 수 있다.
- 그렇기 때문에 요청 사항이 증가할 때 이러한 트래픽을 나눠주기 위해 스케일링을 사용한다. (스케일링은 서버를 통째로 복사하는 기능)
- 하지만, 프론트와 백엔드 서버거 한 서버에 저장되어 있을 때, 프론트 서버의 트래픽 때문에 스케일링을 하더라도 백엔드 서버까지 불필요하게 생기게 된다.
  (반대의 경우도 동일)
- 따라서 프론트 서버와 백엔드 서버를 따로 관리하고 상황에 따라 해당 서버에 맞춰 스케일링을 해주는 유동적인 자세가 필요하다.

```
  ex)
  - 배달의 민족의 경우 피크타임 때 주문에 관련된 요청이 많이 오기 때문에 주문 관련된 서버를 업스케일링하려 할 때,
  - 백엔드 기준 한 서버에서 모든 api를 관리할 경우 주문에 불필요한 `상품 등록` 과 같은 기능들이 스케일링될 필요는 없기 때문이다.
  - 따라서, 스케일링이 필요한 부분에 따라 서버를 따로 구성하는 자세가 필요하다.
```

# 2. 익스프레스 사용하기

- 앞서 말한 것처럼 서버를 돌리기 위해서는 node에서 제공하는 http를 사용해야한다.

```js
app.get('/', (req, res) => {
  res.send('hello express');
});

app.get('/api', (req, res) => {
  res.send('hello api');
});

app.get('/api/posts', (req, res) => {
  res.json([
    { id: 1, content: 'hello' },
    { id: 2, content: 'hello2' },
    { id: 3, content: 'hello3' },
  ]);
});

app.post('/api/post', (req, res) => {
  res.json({
    id: 1,
    content: 'hello',
  });
});

app.delete('/api/post', (req, res) => {
  res.json({
    id: 1,
  });
});
```

- 위 코드를 보면 '/' 넘겨 받는 주소와 넘겨 주는 데이터는 모두 프론트<->백 개발자의 협의로 만들어진 것을 알 수 있다.
- app.get / post / delete / put / patch / options / head 와 같은 restful한 api를 많이 쓴다.
- 주로 ㅆ는 restAPI는 postman에서도 확인이 가능하다.
- 🌟restfulAPI 주요 용어🌟

|   값    |               의미               |
| :-----: | :------------------------------: |
|   get   |             가져오다             |
|  post   |             생성하다             |
| delete  |               제거               |
|   put   |            전체 수정             |
|  patch  |            부분 수정             |
| options | 찔러 보기(나 요청 보낼 수 있어?) |
|  head   |    헤더만 가져오기(헤더/바디)    |

- 본인의 회사뿐만 아니라 다양한 자료를 참고할 때 보여지는 큰 약속이지 반드시 지켜야하는 것은 아니다.
- 적정 선을 가지고 팀원끼리 타협을 봐서 정하면 된다.

# 2.1 node에서는 왜 export, import를 쓰지 않을까?

- react와 다르게 node에서는 import 대신 require를 , export default 대신에 module.exports를 사용한다.
- react또한 node로 구동되기 때문에 실제로는 require와 module.exports로 사용된다.
- 넥스트에 장착된 웹팩이 이것을 바꿔주기 때문이다.
- 하지만 노드는 웹팩을 쓰지 않기 때문에 require와 module.exports를 사용한다.
  (몇년 후에는 노드쪽도 import와 export default로 통일될 것을 예상한다.)
